# Copilot Prompt Guide

本ガイドは `CODING_STYLE.md` を最大限活かし、質の高い補完/生成結果を得るためのプロンプト記述テンプレ集です。

## 1. 基本原則
1. 文脈 → 目的 → 制約 → 成果物形式 の順で短く。
2. 規約参照を明示（リンク or ファイル名）。
3. 入出力例は最小限でも1つ示すと精度向上。
4. 「除外したいこと」(不要ライブラリ/禁止事項) も書く。
5. 大きいタスクは段階に分解し、小タスク毎に再プロンプト。

## 2. 最小テンプレ
```text
目的: <何をしたいか1行>
背景: <必要なら前提/既存構造>
要件:
 - <機能/制約>
 - <性能/例外/テスト>
スタイル: CODING_STYLE.md に従う (Google Docstring, 型必須, 行長88)
出力: <期待フォーマット (関数のみ/テスト付き/差分パッチ 等)>
```

## 3. 例: 関数実装依頼
```text
目的: CSV行文字列を検証して辞書へ変換する関数を追加したい。
背景: ProgramName/scripts/data_loader.py に追加。列: id(int), name(str), score(float)
要件:
 - 無効行は ValueError
 - 空白trim
 - 数値変換失敗は例外再送出 (raise from)
 - 型アノテーション+Google Docstring+計算量コメント
 - テスト (正常/欠損/型不正) を追加
スタイル: CODING_STYLE.md 準拠
出力: 関数コード + tests/unit/test_data_loader.py のpytestコード
```

## 4. 例: リファクタ依頼
```text
目的: ProgramName/scripts/heavy_calc.py の関数 compute_all を関数分割し複雑度を下げたい。
背景: 行数150, 循環的複雑度 > 15。
要件:
 - ガード節導入
 - 重複ロジック抽出
 - 既存シグネチャ互換
 - 新規内部関数のDocstringと型
 - 既存テストを壊さない
出力: 変更対象関数の差分パッチ形式
```

## 5. 例: テスト生成
```text
目的: ProgramName/common/validators.py の関数 validate_user を網羅テストしたい。
要件:
 - 正常 (最小/最大境界)
 - 空/None/型不正
 - 権限不足例外
 - pytest, Docstring付与, パラメタ化
出力: tests/unit/test_validators.py
```

## 6. 例: 例外ポリシー確認
```text
目的: ProgramName/common/db.py の connect() で捕捉している幅広い except を細分化。
要件:
 - どの標準例外を個別捕捉すべきか提案
 - メッセージを 観測行為+対象+期待vs実際 形式に
 - raise from の適用箇所
出力: 改善案とサンプルコード
```

## 7. 良い追加ヒント例
- 「禁止: グローバル状態追加 / ワイルドカードインポート / print デバッグ」
- 「性能: O(n) 保持、追加のソート禁止」
- 「テスト: fixture未使用でシンプルに」

## 8. 失敗しやすいプロンプトの改善例
| 悪い | 改善 |
| ---- | ---- |
| なんかパーサ書いて | 目的=CSV→dict, 列仕様, エラー条件, 出力形式指定 |
| ログ機能追加して | 何を/どこに/レベル/例外時挙動/Docstring要否 |

## 9. 差分レビュー用プロンプト例
```text
目的: 直近の変更 (compute_area 改修) のスタイル/型/Docstring差異を確認。
要件:
 - 規約違反箇所列挙
 - 修正パッチ案 (apply_patch形式) は別セクション
 - 修正不要な箇所は説明のみ
```

## 10. FAQ
Q. どこまで詳細に書くべき?  
A. 不変要件(インターフェース/性能/例外契約)は明示。実装戦略は必要最小限。

Q. 途中で方向が変わったら?  
A. 現在の差分と新目標を小さく再提示し再生成。

---
このガイドは進化させてください。頻出パターンを追記し、再利用できる最短プロンプト資産を蓄積します。
